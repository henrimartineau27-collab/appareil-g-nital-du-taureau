<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Schéma interactif — Appareil génital du taureau (vue latérale)</title>
  <style>
    :root{--bg:#f7fbfd;--card:#fff;--accent:#0b6fa4;--ok:#27ae60;--bad:#c0392b}
    body{font-family:Inter, system-ui, Arial, sans-serif;background:var(--bg);margin:0;padding:20px;color:#122}
    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:420px 1fr;gap:18px}
    .panel{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(10,30,40,0.06)}
    h1{font-size:18px;margin:0 0 8px}
    p{margin:6px 0 12px;font-size:14px}
    #game{display:flex;flex-direction:column;gap:10px}
    #palette{display:flex;flex-wrap:wrap;gap:8px}
    .label{padding:6px 10px;border-radius:8px;background:#eef6fb;border:1px solid #d2eaf6;cursor:grab;user-select:none}
    .label[draggable="true"]:active{cursor:grabbing}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:#eee;color:#122}
    .svg-wrap{background:linear-gradient(180deg,#fff,#f4fbff);padding:10px;border-radius:10px}
    svg{width:100%;height:auto}
    .drop-target{fill:transparent;stroke:rgba(10,10,10,0.08);stroke-dasharray:4 6}
    .drop-target.hover{stroke:var(--accent);stroke-dasharray:2 4}
    .placed{font-weight:700}
    .feedback{margin-top:8px}
    .ok{color:var(--ok)}.bad{color:var(--bad)}
    .small{font-size:13px}
    .quiz-instr{background:#fff8e6;padding:8px;border-radius:8px;border:1px solid #f1e3c4}
    footer{grid-column:1/-1;text-align:right;font-size:13px;color:#666;margin-top:8px}
    @media(max-width:900px){.wrap{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Schéma interactif — Appareil génital du taureau (vue latérale)</h1>
      <p>Mode: <strong id="modeLabel">Glisser-déposer</strong> · Langue: <strong>Français</strong></p>

      <div id="game">
        <div class="controls">
          <button id="checkBtn">Vérifier mes réponses</button>
          <button id="showAnsBtn" class="secondary">Montrer les réponses</button>
          <button id="resetBtn" class="secondary">Réinitialiser</button>
          <button id="toggleMode" class="secondary">Basculer vers le quiz</button>
        </div>

        <p class="small">Glisse chaque étiquette sur la zone du schéma correspondant à l'organe demandé. Ensuite clique <em>Vérifier mes réponses</em>.</p>

        <div style="display:flex;gap:12px">
          <div style="width:180px">
            <h3 style="margin:6px 0">Étiquettes</h3>
            <div id="palette" aria-label="Palette d'étiquettes"></div>
            <p class="small">Si tu utilises un écran tactile : appuie longuement sur une étiquette pour la déplacer.</p>
          </div>

          <div class="svg-wrap" style="flex:1">
            <!-- Schéma simplifié en SVG (vue latérale). Les zones sont approximatives pour l'exercice. -->
            <svg viewBox="0 0 1000 600" id="diagram" role="img" aria-label="Schéma latéral d'un taureau simplifié">
              <!-- silhouette simplifiée (indicative) -->
              <g id="silhouette" transform="translate(0,20)">
                <path d="M50 420 C120 270 300 200 500 200 C720 200 880 260 940 400 L940 460 L60 460 Z" fill="#f0f6f8" stroke="#bcd"/>
                <!-- tête/nez: -->
                <ellipse cx="880" cy="330" rx="40" ry="28" fill="#eef5f7"/>
              </g>

              <!-- organes internes zones (transparent shapes) -->
              <!-- Vessie -->
              <rect id="vessie" class="drop-target" x="360" y="280" width="80" height="50" data-name="Vessie"></rect>
              <!-- Prostate (autour de l'urètre, juste sous la vessie) -->
              <ellipse id="prostate" class="drop-target" cx="420" cy="350" rx="36" ry="22" data-name="Prostate"></ellipse>
              <!-- Vésicules séminales -->
              <ellipse id="vesicules" class="drop-target" cx="320" cy="300" rx="48" ry="22" data-name="Vésicules séminales"></ellipse>
              <!-- Ampoules des canaux déférents -->
              <ellipse id="ampoules" class="drop-target" cx="260" cy="320" rx="40" ry="18" data-name="Ampoules des canaux déférents"></ellipse>
              <!-- Canaux déférents (longues lignes) -->
              <path id="canaux" class="drop-target" d="M120 260 C180 270 200 280 240 300" stroke-width="10" stroke-linecap="round" fill="transparent" data-name="Canaux déférents"></path>
              <!-- Épididyme (sur le dessus des testicules) -->
              <ellipse id="epididyme" class="drop-target" cx="120" cy="400" rx="32" ry="20" data-name="Épididyme"></ellipse>
              <!-- Testicules -->
              <circle id="testicules" class="drop-target" cx="120" cy="440" r="32" data-name="Testicules"></circle>
              <!-- Bourse / Scrotum -->
              <ellipse id="bourse" class="drop-target" cx="120" cy="490" rx="48" ry="22" data-name="Bourse / Scrotum"></ellipse>
              <!-- Pénis + S pénien + Gland (pénis visible en bas) -->
              <path id="penis" class="drop-target" d="M500 340 C560 360 640 420 700 480" stroke-width="18" stroke-linecap="round" fill="transparent" data-name="Pénis"></path>
              <circle id="gland" class="drop-target" cx="705" cy="485" r="18" data-name="Gland"></circle>
              <!-- Glandes de Cowper (bulbo-urétrales) petites -->
              <circle id="cowper" class="drop-target" cx="460" cy="360" r="10" data-name="Glandes de Cowper"></circle>
              <!-- Ligament suspenseur (attache haut des testicules vers le haut) -->
              <path id="ligament" class="drop-target" d="M120 380 L180 320" stroke-width="6" stroke-linecap="round" fill="transparent" data-name="Ligament suspenseur"></path>
              <!-- Urètre (ligne) -->
              <path id="uretre" class="drop-target" d="M500 340 C560 360 640 420 700 480" stroke-width="6" stroke-linecap="round" fill="transparent" data-name="Urètre"></path>

              <!-- repères visuels (optionnels) -->
              <g id="hints" opacity="0.08">
                <rect x="352" y="272" width="96" height="66" fill="#0b6fa4"/>
              </g>
            </svg>
          </div>
        </div>

        <div class="feedback" id="feedbackArea"></div>

      </div>
    </div>

    <div class="panel">
      <h3>Quiz</h3>
      <p class="quiz-instr">Tu peux basculer en <strong>quiz</strong> : on te demande un organe et tu dois cliquer sur la zone correcte dans le schéma. Utilise le bouton <em>Basculer vers le quiz</em>.</p>
      <div id="quizArea"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="nextQ" class="secondary">Prochaine question</button>
        <button id="showQcorrect" class="secondary">Montrer la réponse</button>
      </div>
      <div id="quizFeedback" style="margin-top:8px"></div>
    </div>

    <footer class="small">Conçu pour révision — Bac pro CGEA. Schéma simplifié, à visée pédagogique.</footer>
  </div>

<script>
// Liste des organes demandés par l'utilisateur (en français)
const ORGANS = [
  'Prostate',
  'Vésicules séminales',
  "Ampoules des canaux déférents",
  'Vessie',
  'Urètre',
  'Canaux déférents',
  'Pénis',
  'Gland',
  'Testicules',
  'Bourse / Scrotum',
  'Épididyme',
  'Glandes de Cowper',
  'Ligament suspenseur',
  'S pénien'
];

// Mapping id -> canonical name on SVG
const MAP = {
  'prostate':'Prostate',
  'vesicules':'Vésicules séminales',
  'ampoules':'Ampoules des canaux déférents',
  'vessie':'Vessie',
  'uretre':'Urètre',
  'canaux':'Canaux déférents',
  'penis':'Pénis',
  'gland':'Gland',
  'testicules':'Testicules',
  'bourse':'Bourse / Scrotum',
  'epididyme':'Épididyme',
  'cowper':'Glandes de Cowper',
  'ligament':'Ligament suspenseur'
  // note: S pénien is not a separate SVG id — will map to penis area
};

// Add S pénien as alternate name mapping to penis
const ALIASES = {'S pénien':'Pénis'};

let placed = {}; // id of svg element -> label text
let mode = 'drag';

const palette = document.getElementById('palette');
const feedback = document.getElementById('feedbackArea');
const diagram = document.getElementById('diagram');

// build palette labels
function createLabels(){
  palette.innerHTML='';
  ORGANS.forEach(name=>{
    const d = document.createElement('div');
    d.className='label';
    d.draggable=true;
    d.textContent=name;
    d.setAttribute('role','button');
    d.addEventListener('dragstart',onDragStart);
    d.addEventListener('touchstart',onTouchStart,{passive:false});
    palette.appendChild(d);
  })
}
createLabels();

// drag-and-drop events
let dragData = null;
function onDragStart(e){
  dragData = e.target.textContent;
  e.dataTransfer.setData('text/plain',dragData);
}

// touch fallbacks (simple): when touched, mark selected
let touchSelected = null;
function onTouchStart(e){
  e.preventDefault();
  touchSelected = e.target.textContent;
  // highlight possible drop targets visually
  Object.values(document.querySelectorAll('.drop-target')).forEach(el=>el.classList.add('hover'))
}

// add drop listeners to targets
const targets = document.querySelectorAll('.drop-target');
targets.forEach(t=>{
  t.addEventListener('dragover',e=>{e.preventDefault(); t.classList.add('hover')});
  t.addEventListener('dragleave',e=>{t.classList.remove('hover')});
  t.addEventListener('drop',e=>{
    e.preventDefault(); t.classList.remove('hover');
    const name = e.dataTransfer.getData('text/plain') || touchSelected;
    placeLabel(t.id,name);
    touchSelected = null;
    Object.values(document.querySelectorAll('.drop-target')).forEach(el=>el.classList.remove('hover'))
  });
  // click support: clicking target when a label is selected places it
  t.addEventListener('click',()=>{
    if(touchSelected){ placeLabel(t.id,touchSelected); touchSelected=null; }
  })
});

function placeLabel(targetId,label){
  if(!label) return;
  // find previous placement of that label
  for(const k in placed){ if(placed[k]===label){ delete placed[k]; clearLabelFromTarget(k); } }
  placed[targetId]=label;
  showPlacedOnSvg(targetId,label);
}

function showPlacedOnSvg(targetId,label){
  // add a small text element near the target
  clearLabelFromTarget(targetId);
  const target = document.getElementById(targetId);
  const bbox = target.getBBox();
  const tx = bbox.x + bbox.width + 6;
  const ty = bbox.y + bbox.height/2 + 6;
  const existing = document.createElementNS('http://www.w3.org/2000/svg','text');
  existing.setAttribute('x',tx);
  existing.setAttribute('y',ty);
  existing.setAttribute('data-for',targetId);
  existing.setAttribute('font-size','13');
  existing.setAttribute('font-family','Arial');
  existing.setAttribute('fill','#0b6fa4');
  existing.textContent = label;
  existing.classList.add('placed');
  diagram.appendChild(existing);
}

function clearLabelFromTarget(targetId){
  const prev = diagram.querySelectorAll('[data-for]');
  prev.forEach(t=>{ if(t.getAttribute('data-for')===targetId) t.remove(); });
}

function clearAllPlaced(){
  placed = {};
  const prev = diagram.querySelectorAll('[data-for]');
  prev.forEach(t=>t.remove());
}

// check answers
document.getElementById('checkBtn').addEventListener('click',()=>{
  const results = [];
  // for each svg mapping id, check if placed with correct name
  for(const id in MAP){
    const correct = MAP[id];
    const assigned = placed[id];
    if(assigned===correct) results.push({id,ok:true}); else results.push({id,ok:false,assigned});
  }
  // handle S pénien special mapping -> if any target assigned S pénien treat as mapped to penis
  // check user asked Organs list includes 'S pénien' separately; look if any target has that exact label
  for(const id in placed){ if(placed[id]==='S pénien'){ if(MAP[id]==='Pénis') results.push({id,ok:true}); else results.push({id,ok:false,assigned:placed[id]}); } }

  // build feedback
  let correctCount = results.filter(r=>r.ok).length;
  feedback.innerHTML = `<strong>Résultats :</strong> ${correctCount} / ${Object.keys(MAP).length} correct(s).`;
  // mark svg elements visually
  results.forEach(r=>{
    const el = document.getElementById(r.id);
    if(!el) return;
    el.style.stroke = r.ok? 'var(--ok)':'var(--bad)';
    el.style.fill = r.ok? 'rgba(39,174,96,0.07)':'rgba(192,57,43,0.06)';
  });
});

// show answers
document.getElementById('showAnsBtn').addEventListener('click',()=>{
  // place correct labels on corresponding targets
  clearAllPlaced();
  for(const id in MAP){ placed[id]=MAP[id]; showPlacedOnSvg(id,MAP[id]); }
  // ensure S pénien label also shown near penis
  placed['penis']='Pénis';
  showPlacedOnSvg('penis','S pénien (voir Pénis)');
});

// reset
document.getElementById('resetBtn').addEventListener('click',()=>{
  clearAllPlaced();
  // clear strokes/fills
  document.querySelectorAll('.drop-target').forEach(el=>{ el.style.stroke='rgba(10,10,10,0.08)'; el.style.fill='transparent'; });
  feedback.innerHTML = '';
});

// Toggle mode (drag <-> quiz)
document.getElementById('toggleMode').addEventListener('click',()=>{
  if(mode==='drag') enterQuizMode(); else enterDragMode();
});

function enterQuizMode(){
  mode='quiz';
  document.getElementById('modeLabel').textContent='Quiz';
  document.getElementById('palette').style.display='none';
  document.getElementById('checkBtn').style.display='none';
  document.getElementById('showAnsBtn').style.display='inline-block';
  document.getElementById('toggleMode').textContent='Basculer vers Glisser-déposer';
  startQuiz();
}
function enterDragMode(){
  mode='drag';
  document.getElementById('modeLabel').textContent='Glisser-déposer';
  document.getElementById('palette').style.display='flex';
  document.getElementById('checkBtn').style.display='inline-block';
  document.getElementById('toggleMode').textContent='Basculer vers le quiz';
  stopQuiz();
}

// --- QUIZ ---
let quizList = Object.values(MAP).slice(); // list of target names
quizList.push('S pénien'); // include S pénien as requested
let currentQ = null;
const quizArea = document.getElementById('quizArea');
const quizFeedback = document.getElementById('quizFeedback');

function startQuiz(){
  clearAllPlaced();
  quizArea.innerHTML = '<p class="small">Clique sur la zone du schéma qui correspond à l'organe demandé.</p>';
  document.getElementById('nextQ').addEventListener('click',nextQuestion);
  document.getElementById('showQcorrect').addEventListener('click',()=>{ if(currentQ) showCorrectFor(currentQ); });
  // add click listeners to targets
  document.querySelectorAll('.drop-target').forEach(t=>{
    t.addEventListener('click',onTargetClickForQuiz);
  });
  nextQuestion();
}
function stopQuiz(){
  quizArea.innerHTML='';
  quizFeedback.innerHTML='';
  document.querySelectorAll('.drop-target').forEach(t=>{
    t.removeEventListener('click',onTargetClickForQuiz);
    t.style.stroke='rgba(10,10,10,0.08)'; t.style.fill='transparent';
  });
}

function nextQuestion(){
  quizFeedback.innerHTML='';
  // pick a random organ
  const i = Math.floor(Math.random()*quizList.length);
  currentQ = quizList[i];
  quizArea.innerHTML = `<p><strong>Question :</strong> Clique sur -> <em>${currentQ}</em></p>`;
}

function onTargetClickForQuiz(e){
  if(!currentQ) return;
  const clickedId = e.currentTarget.id;
  // compute correct id(s) for currentQ
  const correctIds = getIdsForName(currentQ);
  if(correctIds.includes(clickedId)){
    quizFeedback.innerHTML = `<span class='ok'>✔ Correct — ${currentQ}.</span>`;
    // highlight correct
    e.currentTarget.style.stroke='var(--ok)'; e.currentTarget.style.fill='rgba(39,174,96,0.06)';
  } else {
    quizFeedback.innerHTML = `<span class='bad'>✖ Faux. Réessaie ou clique sur 'Montrer la réponse'.</span>`;
    e.currentTarget.style.stroke='var(--bad)'; e.currentTarget.style.fill='rgba(192,57,43,0.05)';
  }
}

function getIdsForName(name){
  // return array of svg ids that match name
  const ids = [];
  for(const id in MAP){ if(MAP[id]===name) ids.push(id); }
  // handle aliases
  if(ALIASES[name]){
    for(const id in MAP){ if(MAP[id]===ALIASES[name]) ids.push(id); }
  }
  // S pénien -> penis id
  if(name==='S pénien') ids.push('penis');
  return ids;
}

function showCorrectFor(name){
  const ids = getIdsForName(name);
  // highlight them
  document.querySelectorAll('.drop-target').forEach(el=>{ el.style.stroke='rgba(10,10,10,0.08)'; el.style.fill='transparent'; });
  ids.forEach(id=>{ const el = document.getElementById(id); if(el){ el.style.stroke='var(--accent)'; el.style.fill='rgba(11,111,164,0.06)'; } });
}

// expose simple keyboard help
window.addEventListener('keydown',e=>{ if(e.key==='r') document.getElementById('resetBtn').click(); });

// init
enterDragMode();

</script>
</body>
</html>
